<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cycling Training Dashboard - Eiwe Lingefors</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --bg-primary: #0f1117;
  --bg-card: #1a1d27;
  --bg-card-alt: #1e2130;
  --border: #2a2d3a;
  --text-primary: #e8eaf0;
  --text-secondary: #9ca3b4;
  --text-muted: #6b7280;
  --blue: #3b82f6;
  --blue-light: #60a5fa;
  --blue-dim: #1e3a5f;
  --red: #ef4444;
  --red-light: #f87171;
  --red-dim: #5f1e1e;
  --green: #22c55e;
  --green-light: #4ade80;
  --green-dim: #1e5f2e;
  --yellow: #eab308;
  --yellow-dim: #5f4e1e;
  --orange: #d97706;
  --purple: #a855f7;
  --cyan: #7dd3fc;
  --accent: #3b82f6;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
}
/* Section Nav */
.section-nav {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(15,17,23,0.95);
  backdrop-filter: blur(8px);
  border-bottom: 1px solid var(--border);
  margin-bottom: 20px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  white-space: nowrap;
  scrollbar-width: none;
}
.section-nav::-webkit-scrollbar { display: none; }
.section-nav-inner {
  display: flex;
  gap: 0;
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 20px;
}
.section-nav a {
  display: inline-block;
  padding: 12px 18px;
  color: var(--text-secondary);
  text-decoration: none;
  font-size: 13px;
  font-weight: 500;
  border-bottom: 2px solid transparent;
  transition: color 0.2s, border-color 0.2s;
}
.section-nav a:hover {
  color: var(--text-primary);
  border-bottom-color: var(--blue);
}
/* Collapsible sections */
.collapsible-header {
  cursor: pointer;
  user-select: none;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.collapsible-header .toggle-icon {
  font-size: 24px;
  color: var(--text-secondary);
  transition: transform 0.2s;
  padding: 4px 8px;
}
.collapsible-header.open .toggle-icon { transform: rotate(90deg); }
.collapsible-content { display: none; }
.collapsible-content.open { display: block; }
/* Today's Focus */
.today-focus {
  padding: 16px 20px;
  background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(59,130,246,0.06));
  border: 1px solid rgba(59,130,246,0.2);
  border-radius: 10px;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
}
.today-focus .focus-icon { font-size: 24px; }
.today-focus .focus-text { font-size: 15px; font-weight: 600; color: var(--text-primary); }
.today-focus .focus-detail { font-size: 13px; color: var(--text-secondary); }
/* TSS toggle */
.tss-toggle {
  display: inline-block;
  padding: 4px 12px;
  background: rgba(59,130,246,0.12);
  border: 1px solid rgba(59,130,246,0.25);
  border-radius: 6px;
  color: var(--blue-light);
  font-size: 12px;
  cursor: pointer;
  margin-left: 12px;
}
.tss-toggle:hover { background: rgba(59,130,246,0.2); }
/* Data freshness */
.data-freshness {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  background: rgba(34,197,94,0.08);
  border: 1px solid rgba(34,197,94,0.15);
  border-radius: 12px;
  font-size: 11px;
  color: var(--green-light);
  margin-top: 6px;
}
.data-freshness .pulse {
  width: 6px; height: 6px;
  background: var(--green);
  border-radius: 50%;
}
.container { max-width: 1400px; margin: 0 auto; padding: 20px; }
.header {
  background: linear-gradient(135deg, #1a1d27 0%, #0f1117 100%);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 28px 32px;
  margin-bottom: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 16px;
}
.header-left h1 {
  font-size: 28px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--blue-light), var(--cyan));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: -0.5px;
}
.header-left .subtitle { color: var(--text-secondary); font-size: 14px; margin-top: 2px; }
.header-stats {
  display: flex;
  gap: 24px;
  flex-wrap: wrap;
}
.stat-box {
  text-align: center;
  padding: 8px 16px;
  background: rgba(59,130,246,0.08);
  border: 1px solid rgba(59,130,246,0.15);
  border-radius: 10px;
  min-width: 90px;
}
.stat-box.red { background: rgba(239,68,68,0.08); border-color: rgba(239,68,68,0.15); }
.stat-box.green { background: rgba(34,197,94,0.08); border-color: rgba(34,197,94,0.15); }
.stat-box.orange { background: rgba(217,119,6,0.08); border-color: rgba(249,115,22,0.15); }
.stat-box .value { font-size: 24px; font-weight: 700; }
.stat-box .label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
.stat-box.blue .value { color: var(--blue-light); }
.stat-box.red .value { color: var(--red-light); }
.stat-box.green .value { color: var(--green-light); }
.stat-box.orange .value { color: var(--orange); }
.countdown-box {
  text-align: center;
  padding: 12px 20px;
  background: linear-gradient(135deg, rgba(59,130,246,0.12), rgba(6,182,212,0.12));
  border: 1px solid rgba(59,130,246,0.25);
  border-radius: 12px;
}
.countdown-box .days { font-size: 36px; font-weight: 800; color: var(--cyan); }
.countdown-box .label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; }
.grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.grid-full { grid-column: 1 / -1; }
.card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  overflow: hidden;
}
.card h2 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 16px;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 8px;
}
.card h2 .icon { font-size: 18px; }
.card h3 {
  font-size: 14px;
  font-weight: 600;
  margin: 16px 0 8px;
  color: var(--text-secondary);
}
.chart-container { position: relative; height: 280px; }
.chart-container.tall { height: 320px; }
.mini-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 12px;
  margin-bottom: 16px;
}
.mini-stat {
  padding: 12px;
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  text-align: center;
}
.mini-stat .val { font-size: 20px; font-weight: 700; }
.mini-stat .lbl { font-size: 11px; color: var(--text-muted); text-transform: uppercase; }
.insight-card {
  padding: 14px 16px;
  background: rgba(59,130,246,0.06);
  border-left: 3px solid var(--blue);
  border-radius: 0 8px 8px 0;
  margin-bottom: 10px;
  font-size: 13px;
  line-height: 1.5;
}
.insight-card .type { font-weight: 600; color: var(--blue-light); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
.segment-table { width: 100%; border-collapse: collapse; font-size: 13px; }
.segment-table th {
  text-align: left;
  padding: 8px 10px;
  border-bottom: 1px solid var(--border);
  color: var(--text-secondary);
  font-weight: 500;
  font-size: 11px;
  text-transform: uppercase;
}
.segment-table td {
  padding: 8px 10px;
  border-bottom: 1px solid rgba(42,45,58,0.5);
  color: var(--text-primary);
}
.segment-table tr:hover td { background: rgba(255,255,255,0.02); }
.badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
}
.badge-green { background: var(--green-dim); color: var(--green-light); }
.badge-yellow { background: var(--yellow-dim); color: var(--yellow); }
.badge-red { background: var(--red-dim); color: var(--red-light); }
.badge-blue { background: var(--blue-dim); color: var(--blue-light); }
.coach-text {
  font-size: 14px;
  line-height: 1.75;
  color: var(--text-secondary);
}
.coach-text p { margin-bottom: 16px; }
.coach-text strong { color: var(--text-primary); }
.finding-box {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: rgba(34,197,94,0.06);
  border: 1px solid rgba(34,197,94,0.15);
  border-radius: 8px;
  margin: 12px 0;
  font-size: 13px;
}
.finding-box .emoji { font-size: 20px; }
.recovery-bracket {
  display: flex;
  gap: 12px;
  margin: 12px 0;
}
.bracket {
  flex: 1;
  padding: 12px;
  border-radius: 8px;
  text-align: center;
}
.bracket.red-b { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); }
.bracket.yellow-b { background: rgba(234,179,8,0.1); border: 1px solid rgba(234,179,8,0.2); }
.bracket.green-b { background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.2); }
.bracket .bracket-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; }
.bracket .bracket-value { font-size: 22px; font-weight: 700; margin: 4px 0; }
.bracket .bracket-n { font-size: 11px; color: var(--text-muted); }
.phase-indicator {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
}
.phase-base { background: rgba(59,130,246,0.15); color: var(--blue-light); }
.stop-timeline {
  position: relative;
  padding-left: 24px;
  border-left: 2px solid var(--border);
}
.stop-item {
  position: relative;
  padding: 10px 0 10px 16px;
}
.stop-item::before {
  content: '';
  position: absolute;
  left: -29px;
  top: 16px;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--blue);
  border: 2px solid var(--bg-card);
}
.stop-item.hot::before { background: var(--orange); }
.stop-item .stop-name { font-weight: 600; font-size: 14px; }
.stop-item .stop-detail { font-size: 12px; color: var(--text-secondary); }
.weekly-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
}
.ftp-timeline {
  display: flex;
  align-items: center;
  gap: 0;
  margin: 16px 0;
  position: relative;
}
.ftp-marker {
  text-align: center;
  flex: 1;
  position: relative;
  padding-top: 24px;
}
.ftp-marker::before {
  content: '';
  position: absolute;
  top: 8px;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--blue), var(--cyan));
}
.ftp-marker .dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--blue-light);
  margin: 0 auto 6px;
  position: relative;
  z-index: 1;
}
.ftp-marker .ftp-val { font-size: 18px; font-weight: 700; color: var(--blue-light); }
.ftp-marker .ftp-date { font-size: 11px; color: var(--text-muted); }
@media (max-width: 900px) {
  .grid, .grid-3 { grid-template-columns: 1fr; }
  .header { flex-direction: column; align-items: flex-start; }
  .header-stats { width: 100%; display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
}
/* Mobile sticky mini-header */
.mobile-sticky-header {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 200;
  background: rgba(15,17,23,0.97);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--border);
  padding: 8px 16px;
  justify-content: space-around;
  font-size: 12px;
  font-weight: 600;
}
.mobile-sticky-header .ms-item { text-align: center; }
.mobile-sticky-header .ms-val { color: var(--blue-light); font-size: 16px; }
.mobile-sticky-header .ms-lbl { color: var(--text-muted); font-size: 10px; text-transform: uppercase; }
/* Table scroll wrapper */
.table-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
@media (max-width: 600px) {
  .mobile-sticky-header { display: flex; }
  body { padding-top: 52px; }
  .container { padding: 12px; }
  .header { padding: 16px; border-radius: 10px; }
  .header-left h1 { font-size: 22px; }
  .header-stats { grid-template-columns: repeat(2, 1fr); gap: 6px; }
  .stat-box { padding: 6px 8px; min-width: unset; }
  .stat-box .value { font-size: 18px; }
  .countdown-box { padding: 8px 12px; }
  .countdown-box .days { font-size: 24px; }
  .card { padding: 16px; border-radius: 10px; }
  .card h2 { font-size: 14px; }
  .mini-stats { grid-template-columns: repeat(2, 1fr); gap: 8px; }
  .segment-table { font-size: 12px; }
  .segment-table th, .segment-table td { padding: 6px; }
  .section-nav a { padding: 10px 12px; font-size: 12px; }
  .recovery-bracket { flex-direction: column; }
  .chart-container { height: 200px !important; }
  .chart-container.tall { height: 240px !important; }
  .grid-3 > div .chart-container { height: 180px !important; }
  .ftp-timeline { flex-wrap: wrap; }
  .ftp-marker .ftp-val { font-size: 14px; }
  .coach-text { font-size: 13px; }
  .stop-timeline { padding-left: 16px; }
}
</style>
</head>
<body>
<div class="mobile-sticky-header">
  <div class="ms-item"><div class="ms-val">263W</div><div class="ms-lbl">FTP</div></div>
  <div class="ms-item"><div class="ms-val">46.0</div><div class="ms-lbl">CTL</div></div>
  <div class="ms-item"><div class="ms-val">114d</div><div class="ms-lbl">Halvvattern</div></div>
  <div class="ms-item"><div class="ms-val">121d</div><div class="ms-lbl">Vatternrundan</div></div>
</div>
<div class="container">

<!-- HEADER -->
<div class="header">
  <div class="header-left">
    <h1>Eiwe Lingefors</h1>
    <div class="subtitle">Training Dashboard &middot; Feb 12, 2026 &middot; Coach: Max Blinderman</div>
  </div>
  <div class="header-stats">
    <div class="countdown-box">
      <div class="days">114</div>
      <div class="label">Days to Halvvattern</div>
    </div>
    <div class="countdown-box">
      <div class="days">121</div>
      <div class="label">Days to Vatternrundan</div>
    </div>
    <div class="stat-box blue">
      <div class="value">263W</div>
      <div class="label">FTP</div>
    </div>
    <div class="stat-box blue">
      <div class="value">46.0</div>
      <div class="label">CTL (Fitness)</div>
    </div>
    <div class="stat-box red">
      <div class="value">50.0</div>
      <div class="label">ATL (Fatigue)</div>
    </div>
    <div class="stat-box green">
      <div class="value">-4.0</div>
      <div class="label">TSB (Form)</div>
    </div>
  </div>
</div>

<!-- SECTION NAV -->
<div class="section-nav">
  <div class="section-nav-inner">
    <a href="#overview">Overview</a>
    <a href="#this-week">This Week</a>
    <a href="#recovery">Recovery</a>
    <a href="#training">Training</a>
    <a href="#race-plans">Race Plans</a>
    <a href="#coach">Coach</a>
    <a href="#" onclick="document.getElementById('about-modal').style.display='flex';return false;">About</a>
  </div>
</div>

<!-- THIS WEEK (moved to position #2) -->
<div id="this-week" style="margin-bottom:20px">
  <div class="card">
    <h2><span class="icon">üìã</span> This Week (Feb 09-15, 2026)</h2>
    <div class="today-focus">
      <span class="focus-icon">üò¥</span>
      <div>
        <div class="focus-text">Today's Focus: Rest Day</div>
        <div class="focus-detail">Next workout: Friday Endurance (TSS 54 planned)</div>
      </div>
    </div>
    <div class="mini-stats">
      <div class="mini-stat"><div class="val" style="color:var(--blue-light)">138</div><div class="lbl">TSS Actual</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--text-secondary)">396</div><div class="lbl">TSS Planned</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--green-light)">34%</div><div class="lbl">Progress</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--blue-light)">0.0h</div><div class="lbl">Hours Done</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--blue-light)">2/5</div><div class="lbl">Completed</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--blue-light)">0.69</div><div class="lbl">Avg IF</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--orange)">0.81</div><div class="lbl">Peak IF</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--yellow)">62%</div><div class="lbl">Avg Recovery</div></div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:16px">
      <div>
        <h3>Workouts</h3>
        <div class="table-scroll"><table class="segment-table">
          <thead><tr><th>Day</th><th>Workout</th><th>TSS</th><th>NP</th><th>Quality</th></tr></thead>
          <tbody>
            <tr><td>Mon</td><td colspan="4" style="color:var(--text-muted)">Day Off</td></tr>
            <tr><td>Tue</td><td>Endurance</td><td>40.5</td><td>149W</td><td><span class="badge badge-yellow">74</span></td></tr>
            <tr><td>Wed</td><td>Sweetspot Surges</td><td>97.5</td><td>212W</td><td><span class="badge badge-green">89</span></td></tr>
            <tr><td>Thu</td><td colspan="4" style="color:var(--text-muted)">Day Off</td></tr>
            <tr style="opacity:0.6"><td>Fri</td><td>Endurance</td><td colspan="2" style="color:var(--text-muted)">TSS 54 planned</td><td><span class="badge" style="background:var(--surface-elevated);color:var(--text-muted)">Upcoming</span></td></tr>
            <tr style="opacity:0.6"><td>Sat</td><td>Long Ride - Tempo / Sweetspot Hour</td><td colspan="2" style="color:var(--text-muted)">TSS 121 planned</td><td><span class="badge" style="background:var(--surface-elevated);color:var(--text-muted)">Upcoming</span></td></tr>
            <tr style="opacity:0.6"><td>Sun</td><td>Free Ride</td><td colspan="2" style="color:var(--text-muted)">TSS 65 planned</td><td><span class="badge" style="background:var(--surface-elevated);color:var(--text-muted)">Upcoming</span></td></tr>
          </tbody>
        </table></div>
      </div>
      <div>
        <h3>PMC Trend</h3>
        <div style="font-size:14px;color:var(--text-secondary);line-height:2">
          CTL: 46.0 (+4.3 this week) <span style="color:var(--green-light)">&uarr;</span><br>
          ATL: 50.0<br>
          TSB: -4.0 &mdash; Absorbing load well<br>
          <span style="color:var(--text-muted)">FTP: 263W &rarr; Target 300W</span>
        </div>
        <h3 style="margin-top:16px">Recovery This Week</h3>
        <div style="font-size:14px;color:var(--text-secondary);line-height:2">
          Avg Recovery: 62% <span class="badge badge-yellow">Yellow</span><br>
          Avg HRV: 35ms<br>
          Avg Sleep: 6.8 hrs
        </div>
      </div>
    </div>
  </div>


</div>

<!-- ROW 1: Training Load + PMC -->
<div id="overview" class="grid">
  <div class="card">
    <h2><span class="icon">üìä</span> Weekly Training Load <span id="tssRangeLabel">(Last 20 Weeks)</span> <span class="tss-toggle" id="tssToggle" onclick="toggleTSSRange()">Show full year</span></h2>
    <div class="chart-container tall">
      <canvas id="tssChart"></canvas>
    </div>
  </div>
  <div class="card">
    <h2><span class="icon">üìà</span> Performance Management Chart</h2>
    <div class="chart-container tall">
      <canvas id="pmcChart"></canvas>
    </div>
  </div>
</div>

<!-- Power Zone Distribution -->
<div class="card" style="margin-bottom:20px">
  <h2><span class="icon">üéØ</span> Power Zone Distribution (by Workout Type)</h2>
  <div style="display:flex;gap:24px;align-items:center;flex-wrap:wrap">
    <div style="width:240px;height:240px;flex-shrink:0"><canvas id="zoneDonut"></canvas></div>
    <div style="flex:1;min-width:200px">
      <div class="mini-stats" style="grid-template-columns:repeat(3,1fr)">
        <div class="mini-stat"><div class="val" style="color:var(--blue-light)">155.5h</div><div class="lbl">Endurance (89)</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--green-light)">48.3h</div><div class="lbl">Tempo (33)</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--red-light)">83.8h</div><div class="lbl">Threshold/VO2 (53)</div></div>
        <div class="mini-stat"><div class="val" style="color:#94a3b8">10.1h</div><div class="lbl">Free Ride (7)</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--yellow)">25.3h</div><div class="lbl">Sweetspot (10)</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--orange)">0.0h</div><div class="lbl">Other High Int. (0)</div></div>
      </div>
      <div style="margin-top:12px;font-size:12px;color:var(--text-muted)">Based on 192 completed workouts. Classified by workout title/type, not IF (IF misclassifies threshold workouts as tempo due to warmup/cooldown).</div>
    </div>
  </div>
</div>

<!-- ROW 2: Recovery Dashboard -->
<div id="recovery" class="card" style="margin-bottom:20px">
  <h2><span class="icon">üíö</span> Recovery Dashboard (30 Days)</h2>
  <div class="finding-box">
    <span class="emoji">üî¨</span>
    <span><strong>Key Finding:</strong> Recovery score has minimal impact on workout quality (r=0.11). Eiwe performs consistently regardless of Whoop recovery color. Based on 159 days of data.</span>
  </div>
  <div class="grid-3" style="margin-bottom:0">
    <div>
      <h3>Recovery Score</h3>
      <div class="chart-container" style="height:270px"><canvas id="recoveryChart"></canvas></div>
    </div>
    <div>
      <h3>HRV Trend (7-day avg)</h3>
      <div class="chart-container" style="height:270px"><canvas id="hrvChart"></canvas></div>
    </div>
    <div>
      <h3>Sleep Hours</h3>
      <div class="chart-container" style="height:270px"><canvas id="sleepChart"></canvas></div>
    </div>
  </div>
  <div class="mini-stats" style="margin-top:12px">
    <div class="mini-stat"><div class="val" style="color:var(--yellow)">60%</div><div class="lbl">7-Day Avg Recovery</div></div>
    <div class="mini-stat"><div class="val" style="color:var(--blue-light)">35.0ms</div><div class="lbl">7-Day Avg HRV</div></div>
    <div class="mini-stat"><div class="val" style="color:var(--blue-light)">6.9hrs</div><div class="lbl">7-Day Avg Sleep</div></div>
    <div class="mini-stat"><div class="val" style="color:var(--text-secondary)">-5%</div><div class="lbl">Recovery 30d Change</div></div>
  </div>
</div>

<!-- ROW 3: Workout Quality + FTP -->
<div id="training" class="grid">
  <div class="card">
    <h2><span class="icon">üèãÔ∏è</span> Workout Quality Analysis</h2>
    <h3>Quality by Recovery Bracket</h3>
    <div class="recovery-bracket">
      <div class="bracket red-b">
        <div class="bracket-label">Red (&lt;33%)</div>
        <div class="bracket-value" style="color:var(--red-light)">87.3</div>
        <div class="bracket-n">n=8</div>
      </div>
      <div class="bracket yellow-b">
        <div class="bracket-label">Yellow (33-66%)</div>
        <div class="bracket-value" style="color:var(--yellow)">88.0</div>
        <div class="bracket-n">n=77</div>
      </div>
      <div class="bracket green-b">
        <div class="bracket-label">Green (&gt;66%)</div>
        <div class="bracket-value" style="color:var(--green-light)">88.9</div>
        <div class="bracket-n">n=74</div>
      </div>
    </div>
    <div class="finding-box" style="background:rgba(59,130,246,0.06);border-color:rgba(59,130,246,0.15)">
      <span class="emoji">üí™</span>
      <span>Only 1.6 point spread across all brackets. Mental toughness confirmed by data.</span>
    </div>
    <h3>Quality Over Time</h3>
    <div class="chart-container" style="height:180px"><canvas id="qualityChart"></canvas></div>
    <h3 style="margin-top:12px">Best Workout Conditions (Top 20)</h3>
    <div class="mini-stats">
      <div class="mini-stat"><div class="val" style="color:var(--green-light)">67%</div><div class="lbl">Recovery</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--blue-light)">39ms</div><div class="lbl">HRV</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--blue-light)">6.7h</div><div class="lbl">Sleep</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--blue-light)">96.5</div><div class="lbl">Avg Quality</div></div>
    </div>
  </div>

  <div class="card">
    <h2><span class="icon">‚ö°</span> FTP Trajectory</h2>
    <div class="ftp-timeline">
      <div class="ftp-marker"><div class="dot"></div><div class="ftp-val">263W</div><div class="ftp-date">Now (Feb 12)</div></div>
      <div class="ftp-marker"><div class="dot"></div><div class="ftp-val">260-270W</div><div class="ftp-date">Next Test (Feb 26)</div></div>
      <div class="ftp-marker"><div class="dot"></div><div class="ftp-val">277-287W</div><div class="ftp-date">Vatternrundan (Jun 13)</div></div>
      <div class="ftp-marker"><div class="dot" style="background:var(--green-light)"></div><div class="ftp-val" style="color:var(--green-light)">300W</div><div class="ftp-date">Target (Dec 31)</div></div>
    </div>
    <div class="mini-stats" style="margin-top:20px">
      <div class="mini-stat"><div class="val" style="color:var(--blue-light)">263W</div><div class="lbl">Current FTP (est.)</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--yellow)">214W</div><div class="lbl">Recent Max NP</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--orange)">243W</div><div class="lbl">Peak NP (Jun '25)</div></div>
      <div class="mini-stat"><div class="val" style="color:var(--blue-light)">FLAT</div><div class="lbl">NP Trend (3mo)</div></div>
    </div>

    <div class="insight-card" style="margin:16px 0;border-color:var(--yellow);background:rgba(234,179,8,0.06)">
      <div class="type" style="color:var(--yellow)">Base Phase Reality Check</div>
      NP trend is flat over the last 3 months (212-215W). This is expected and normal during base phase: high volume, lower intensity. CTL is climbing (46.0, up from low 20s), which means aerobic fitness is building even though peak power numbers haven't moved yet. The build phase (Apr-May) is where threshold work drives FTP gains. Peak summer NP hit 243W in Jun '25 with a lower CTL. With a stronger base this year, similar or higher peaks are achievable.
    </div>

    <h3>Monthly Max NP Trend (High-IF Workouts)</h3>
    <div class="chart-container" style="height:160px"><canvas id="npTrendChart"></canvas></div>

    <h3 style="margin-top:16px">FTP Projection (Data-Driven)</h3>
    <div class="chart-container" style="height:200px"><canvas id="ftpChart"></canvas></div>
    <div style="font-size:12px;color:var(--text-muted);margin-top:8px">
      Projection based on actual NP trends, not linear extrapolation. Base phase plateau through March, build phase gains Apr-May, peak at race time. 300W target requires strong summer/fall block.
    </div>
  </div>
</div>

<!-- Key Insights (bridge between training metrics and race planning) -->
<div class="card" style="margin-bottom:20px">
  <h2><span class="icon">üí°</span> Key Insights</h2>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
    <div class="insight-card">
      <div class="type">üü¢ Recovery Correlation (High Confidence)</div>
      Your data shows recovery score has minimal impact on workout quality (green: 88.9, red: 87.3, r=0.11). You perform consistently regardless of recovery. Based on 159 days.
    </div>
    <div class="insight-card" style="border-color:var(--blue-light);background:rgba(59,130,246,0.06)">
      <div class="type" style="color:var(--blue-light)">üü° HRV Threshold (Medium)</div>
      Best workouts (quality &ge;80, n=145) typically occur when HRV is above 31ms. Average HRV on good days: 36ms vs other days: 34ms.
    </div>
    <div class="insight-card" style="border-color:var(--yellow);background:rgba(234,179,8,0.06)">
      <div class="type" style="color:var(--yellow)">üî¥ Sleep Impact (Low Confidence)</div>
      Sleep hours correlate with workout quality at r=0.09 (n=159). Average sleep 6.7 hrs. 7.5+ hrs shows quality of 87.1 vs 86.2 on &lt;6 hr nights. Minimal difference.
    </div>
    <div class="insight-card" style="border-color:var(--green);background:rgba(34,197,94,0.06)">
      <div class="type" style="color:var(--green)">üü¢ Consistency (High Confidence)</div>
      Workout completion rate: 74.1% (163/220 planned workouts).
    </div>
    <div class="insight-card" style="border-color:var(--blue-light);background:rgba(59,130,246,0.06);grid-column:1/-1">
      <div class="type" style="color:var(--blue-light)">üü° FTP Outlook (Medium Confidence)</div>
      NP trend flat at 212-215W over last 3 months (base phase). Peak NP was 243W in Jun '25. FTP gains expected during build phase (Apr-May). Next test (~Feb 26) prediction: 260-270W. 300W target requires strong summer/fall block.
    </div>
  </div>
</div>

<!-- ROW 4: Race Plan -->
<div id="race-plans" class="card" style="margin-bottom:20px">
  <h2 class="collapsible-header" onclick="toggleSection(this)"><span><span class="icon">üèÅ</span> V&auml;tternrundan: 315km, June 13, Sub-10h target</span><span class="toggle-icon">‚ñ∏</span></h2>
  <div class="collapsible-content">
  <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap">
    <span class="badge badge-blue">315 km / 196 mi</span>
    <span class="badge badge-green">Target: Sub-10 Hours (finish by 1:20 PM)</span>
    <span class="badge badge-yellow">Start: 03:20 AM &middot; 4 Stops</span>
    <span class="badge badge-blue">Riding with friend (drafting)</span>
    <span class="phase-indicator phase-base">üîµ Current Phase: BASE</span>
  </div>

  <div class="grid" style="margin-bottom:0">
    <div>
      <h3>Course Segments &amp; Power Targets</h3>
      <div class="table-scroll"><table class="segment-table">
        <thead><tr><th>Segment</th><th>Distance</th><th>Power @ 277W FTP</th></tr></thead>
        <tbody>
          <tr><td>First 100 km</td><td>0-62 mi</td><td>155-169W (56-61%)</td></tr>
          <tr><td>Km 100-230</td><td>62-143 mi</td><td>169-180W (61-65%)</td></tr>
          <tr><td>Km 230-315</td><td>143-196 mi</td><td>180-194W (65-70%)</td></tr>
        </tbody>
      </table></div>
      <div class="mini-stats" style="margin-top:12px">
        <div class="mini-stat"><div class="val" style="color:var(--blue-light)">175-180W</div><div class="lbl">Target NP</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--red-light)">208W</div><div class="lbl">Climb Cap (75%)</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--blue-light)">~411</div><div class="lbl">Est. TSS</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--green-light)">IF 0.64</div><div class="lbl">Target IF</div></div>
      </div>

      <h3 style="margin-top:16px">2025 Race Comparison</h3>
      <div class="table-scroll"><table class="segment-table">
        <thead><tr><th>Metric</th><th>2025 (Solo)</th><th>2026 Target</th></tr></thead>
        <tbody>
          <tr><td>Time</td><td>10h09m</td><td>&lt;10h00m</td></tr>
          <tr><td>NP</td><td>215W</td><td>175-180W</td></tr>
          <tr><td>IF</td><td>0.82</td><td>~0.64</td></tr>
          <tr><td>TSS</td><td>682</td><td>~411</td></tr>
          <tr><td>Avg HR</td><td>142</td><td>TBD</td></tr>
          <tr><td>Start</td><td>Morning</td><td>03:20 AM</td></tr>
          <tr><td>Style</td><td>Solo, pushed hard</td><td>With friend (drafting + morale)</td></tr>
        </tbody>
      </table></div>
      <div class="insight-card" style="margin-top:12px;border-color:var(--green);background:rgba(34,197,94,0.06)">
        <div class="type" style="color:var(--green)">2025 vs 2026 Analysis</div>
        2025 was ridden solo at IF 0.82 / NP 215W &mdash; quite aggressive for a 10-hour effort. The fact Eiwe finished strong (feeling: 1/great) shows deep endurance capacity. 2026 target of IF ~0.64 is far more disciplined pacing, especially in the first half. With a friend for drafting (20-30% energy savings) and better pacing, sub-10 is very achievable.
      </div>
    </div>

    <div>
      <h3>Depot Stops (4 Stops, ~54 min total)</h3>
      <div class="stop-timeline">
        <div class="stop-item">
          <div class="stop-name">&Ouml;lmstad &mdash; 83 km / 52 mi &middot; ~5:58 AM</div>
          <div class="stop-detail">10 min stop. Refill F369 bottles, pickles + bread.</div>
        </div>
        <div class="stop-item hot">
          <div class="stop-name">üçΩÔ∏è J&ouml;nk&ouml;ping &mdash; 104 km / 65 mi &middot; ~6:48 AM</div>
          <div class="stop-detail">22 min stop. HOT FOOD: meatballs, mashed potatoes, blueberry soup. Refill bottles.</div>
        </div>
        <div class="stop-item">
          <div class="stop-name">Karlsborg &mdash; 204 km / 127 mi &middot; ~10:20 AM</div>
          <div class="stop-detail">12 min stop. Refill F369, pickles + bread, stretch.</div>
        </div>
        <div class="stop-item">
          <div class="stop-name">Godeg&aring;rd &mdash; 284 km / 176 mi &middot; ~1:04 PM</div>
          <div class="stop-detail">10 min stop. Last refill, push to finish.</div>
        </div>
      </div>
      <div style="padding:8px 14px;background:rgba(234,179,8,0.08);border-radius:8px;margin-top:8px;font-size:12px;color:var(--text-secondary)">
        <strong style="color:var(--yellow)">Note:</strong> Thousands of participants means depot stops take time. These are realistic estimates.
      </div>
      <div style="padding:10px 14px;background:rgba(217,119,6,0.08);border-radius:8px;margin-top:12px;font-size:12px;color:var(--text-secondary)">
        <strong style="color:var(--orange)">Primary Fuel: Formula 369</strong> &mdash; 30g carbs/scoop, 1:1 glucose:fructose, 200mg sodium. 3 bottles (2 cage + 1 flexible rubber). Mix 2-3 scoops/bottle (60-90g carbs). Target: <strong style="color:var(--text-primary)">80-90g carbs/hour</strong>. Supplemental gels between bottles as needed. Pre-dawn start: 03:20 AM, sunrise 03:51 AM. Only ~30 min of darkness. No night riding..
      </div>

      <h3 style="margin-top:16px">Hourly Fueling Timeline</h3>
      <div class="table-scroll"><table class="segment-table">
        <thead><tr><th>Hour</th><th>Clock Time</th><th>Fueling Plan</th><th>Carbs</th></tr></thead>
        <tbody>
          <tr><td>1</td><td>03:20-04:20</td><td>1 bottle F369 + start eating early</td><td>60-90g</td></tr>
          <tr><td>2-3</td><td>04:20-06:20</td><td>Continue bottles, gel every 45 min. <strong>Stop 1 at 5:52 AM</strong></td><td>160-180g</td></tr>
          <tr><td>4-5</td><td>06:20-08:20</td><td>Steady bottles + gels</td><td>160-180g</td></tr>
          <tr><td>5-6</td><td>08:20-09:20</td><td><strong>J&ouml;nk&ouml;ping 8:43 AM:</strong> hot meal, blueberry soup, refill</td><td>80-90g</td></tr>
          <tr><td>7-8</td><td>09:20-11:20</td><td>Bottles + gels. <strong>Stop 3 at 10:57 AM</strong>, refill</td><td>160-180g</td></tr>
          <tr><td>9-10</td><td>11:20-13:20</td><td><strong>Stop 4 at 12:32 PM</strong>, last refill, final push</td><td>160-180g</td></tr>
          <tr style="background:rgba(34,197,94,0.08)"><td colspan="3"><strong>Total Target (10 hours)</strong></td><td><strong>800-900g (7,000+ cal)</strong></td></tr>
        </tbody>
      </table></div>

      <h3 style="margin-top:16px">Taper Timeline</h3>
      <div class="table-scroll"><table class="segment-table">
        <thead><tr><th>Date</th><th>Phase</th><th>Days Out</th></tr></thead>
        <tbody>
          <tr><td>May 1</td><td>Build phase starts</td><td>78</td></tr>
          <tr><td>May 22</td><td>Peak week</td><td>99</td></tr>
          <tr><td>Jun 6</td><td><span class="badge badge-yellow">üèÅ Halvvattern 150km (peak effort / dress rehearsal)</span></td><td>7</td></tr>
          <tr><td>Jun 7-9</td><td>Easy spins (taper begins)</td><td>4-6</td></tr>
          <tr><td>Jun 10</td><td>Opener session</td><td>3</td></tr>
          <tr><td>Jun 11-12</td><td>Easy spin + prep</td><td>1-2</td></tr>
          <tr><td>Jun 13</td><td><span class="badge badge-green">üèÅ VATTERNRUNDAN (03:20 AM)</span></td><td>0</td></tr>
        </tbody>
      </table></div>
      <div class="mini-stats" style="margin-top:12px">
        <div class="mini-stat"><div class="val" style="color:var(--blue-light)">~61</div><div class="lbl">Proj. Race CTL</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--green-light)">+23</div><div class="lbl">Proj. Race TSB</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--orange)">~54 min</div><div class="lbl">Total Stop Time</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--blue-light)">~10h total</div><div class="lbl">9.1h ride + stops</div></div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ROW 4b: Halvv√§ttern -->
<div class="card" style="margin-bottom:20px">
  <h2 class="collapsible-header" onclick="toggleSection(this)"><span><span class="icon">üî•</span> Halvv&auml;ttern: 150km, June 6, Dress Rehearsal</span><span class="toggle-icon">‚ñ∏</span></h2>
  <div class="collapsible-content">
  <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap">
    <span class="badge badge-blue">150 km / 93 mi</span>
    <span class="badge badge-yellow">June 6, 2026 &middot; 7 days before V&auml;tternrundan</span>
    <span class="badge badge-green">Dress Rehearsal / Peak Effort</span>
    <span class="badge badge-blue">6 Service Stops</span>
  </div>

  <div class="grid" style="margin-bottom:0">
    <div>
      <h3>Route Overview</h3>
      <p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:12px">
        150km loop starting and finishing in Motala. South along V&auml;ttern shore past Vadstena, climbs Omberg nature reserve, south to &Ouml;desh&ouml;g, east through forests, north through farmland via R&ouml;k and medieval churches to Sk&auml;nninge, back to Motala.
      </p>

      <h3>Service Stops</h3>
      <div class="stop-timeline">
        <div class="stop-item">
          <div class="stop-name">Borghamn &mdash; 32 km</div>
          <div class="stop-detail">Full service stop</div>
        </div>
        <div class="stop-item">
          <div class="stop-name">Stocklycke &mdash; 42 km</div>
          <div class="stop-detail">Water only</div>
        </div>
        <div class="stop-item">
          <div class="stop-name">&Ouml;desh&ouml;g &mdash; 53 km</div>
          <div class="stop-detail">Full service stop</div>
        </div>
        <div class="stop-item">
          <div class="stop-name">Boet &mdash; 80 km</div>
          <div class="stop-detail">Water only</div>
        </div>
        <div class="stop-item">
          <div class="stop-name">R&ouml;k &mdash; 103 km</div>
          <div class="stop-detail">Full service stop</div>
        </div>
        <div class="stop-item">
          <div class="stop-name">Sk&auml;nninge &mdash; 127 km</div>
          <div class="stop-detail">Full service stop</div>
        </div>
      </div>
    </div>

    <div>
      <h3>2025 Halvv&auml;ttern Performance (June 7, 2025)</h3>
      <div class="mini-stats">
        <div class="mini-stat"><div class="val" style="color:var(--blue-light)">4h49m</div><div class="lbl">Time</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--blue-light)">92.3 mi</div><div class="lbl">Distance</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--orange)">372</div><div class="lbl">TSS</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--red-light)">0.88</div><div class="lbl">IF</div></div>
      </div>
      <div class="mini-stats">
        <div class="mini-stat"><div class="val" style="color:var(--blue-light)">230W</div><div class="lbl">NP</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--text-secondary)">211W</div><div class="lbl">Avg Power</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--red-light)">145/167</div><div class="lbl">Avg/Max HR</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--green-light)">86</div><div class="lbl">Cadence</div></div>
      </div>
      <div class="mini-stats">
        <div class="mini-stat"><div class="val" style="color:var(--blue-light)">2,628 ft</div><div class="lbl">Elevation</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--yellow)">3,670</div><div class="lbl">Calories</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--green-light)">7 / 1</div><div class="lbl">RPE / Feeling</div></div>
      </div>
      <div class="insight-card" style="margin-top:12px;border-color:var(--orange);background:rgba(217,119,6,0.06)">
        <div class="type" style="color:var(--orange)">Eiwe's 2025 Race Note</div>
        "20 mph headwinds gusting to 45 mph on the large open fields was rough. Thankfully that headwind turned into a tailwind at the southern end."
      </div>

      <h3 style="margin-top:16px">2026 Targets (@ ~277W FTP)</h3>
      <div class="mini-stats">
        <div class="mini-stat"><div class="val" style="color:var(--blue-light)">230-240W</div><div class="lbl">Target NP</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--blue-light)">IF 0.83-0.87</div><div class="lbl">Target IF</div></div>
        <div class="mini-stat"><div class="val" style="color:var(--green-light)">&lt;4h49m</div><div class="lbl">Time Goal</div></div>
      </div>
      <div class="insight-card" style="margin-top:12px;border-color:var(--green);background:rgba(34,197,94,0.06)">
        <div class="type" style="color:var(--green)">Race Strategy</div>
        This is the final hard effort before V&auml;tternrundan. Race it hard as a dress rehearsal &mdash; validate fitness, test fueling, and confirm pacing. The 1-week gap to V&auml;tternrundan is perfect: Halvv&auml;ttern doubles as both peak effort and start of taper. Eiwe did exactly this in 2025 with great results.
      </div>
    </div>
  </div>
</div>

</div>

<!-- ROW 5: Coach Analysis -->
<div id="coach" class="card" style="margin-bottom:20px">
  <h2><span class="icon">üéØ</span> Coaching Assessment</h2>
  <div class="coach-text">
    <p><strong>Current Fitness Trajectory:</strong> Eiwe, your CTL has grown from 2 to 46.0 today over 52 weeks of training. Average weekly TSS over the last 12 weeks is 289, with the last four weeks averaging 356. completion rate of 74%. You are building consistently with strong weekly loads.</p>

    <p><strong>What the Data Says About You:</strong> Three things stand out. <strong>Consistency</strong>: 74.1% overall completion rate. <strong>Mental toughness</strong>: workout quality on red recovery days (87.3) is virtually identical to green days (88.9). Recovery score correlates at r=0.11 with quality; statistically zero. You execute regardless of how you feel, and the data confirms this works for you. <strong>Quality</strong>: average score 88.3, with your most recent Sweetspot Surges hitting 89.2 on Feb 11.</p>

    <p><strong>Areas to Watch:</strong> Recovery trending -5% over the last month. Sleep averaging 6.7 hours; target 7.5+ for a 48-year-old in a loading phase. HRV at 35.0ms is stable but not climbing, which would be the ideal signal. None are red flags, but monitor closely as build phase intensity increases.</p>

    <p><strong>Race Readiness:</strong> At 121 days out, you are well-positioned. CTL 46.0 gives a solid platform; we want 55-65 with TSB +15 to +25 on race day. The taper model projects CTL ~61, TSB ~+23. The 2026 pacing strategy (IF 0.64, NP 175-180W) is significantly more disciplined than 2025's aggressive IF 0.82, while the addition of drafting with a riding partner saves 20-30% energy. Your 2025 solo effort at that intensity, finishing strong with feeling of 1/great, confirms the endurance capacity is there. This year you are riding smarter, not just harder.</p>

    <p><strong>Fueling and Logistics:</strong> Formula 369 at 80-90g carbs/hour with 3 bottles plus gels is solid. Start eating within the first 20 minutes and stay ahead of the deficit all day. Practice this exact protocol on every long training ride. The 03:20 AM start gives you full daylight by mile 10 (sunrise 03:51) and 18+ hours of light. Coordinate stops with your riding partner; the 54-minute total stop budget is realistic for crowded depots.</p>

    <p><strong>Recommendations:</strong> (1) Continue base progression through March at 350-400 TSS/week. (2) Build phase April/May: sweet spot, threshold, race-specific 3-4 hour efforts at target IF. (3) Practice fueling protocol on every long ride; train the gut now. (4) Prioritize sleep: 7.5+ hours during heavy loading. (5) FTP test ~Feb 26 to calibrate zones. (6) One 150+ mile ride in April/May with your partner to practice everything together. (7) Race Halvv&auml;ttern hard June 6, taper through June 12. (8) Practice the 2 AM wake-up before race week.</p>


<!-- ROW 6: Insights + Weekly Summary (moved to top, kept here as anchor) -->
  </div>
</div>
<!-- This Week and Insights already moved to position #2 above -->

<div style="text-align:center;padding:20px;color:var(--text-muted);font-size:12px">
  Generated Feb 12, 2026 &middot; Data from TrainingPeaks + Whoop &middot; Coaching by Max Blinderman
  <br><div class="data-freshness"><span class="pulse"></span> Last synced: Feb 12, 2026</div>
</div>

</div>

<!-- About Modal -->
<div id="about-modal" style="display:none;position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;padding:20px" onclick="if(event.target===this)this.style.display='none'">
  <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;max-width:680px;width:100%;max-height:85vh;overflow-y:auto;padding:32px;position:relative">
    <button onclick="document.getElementById('about-modal').style.display='none'" style="position:absolute;top:16px;right:16px;background:none;border:none;color:var(--text-muted);font-size:24px;cursor:pointer;padding:4px 8px">&times;</button>
    <h2 style="margin:0 0 8px;color:var(--text-primary);font-size:22px">About This Dashboard</h2>
    <p style="color:var(--text-muted);font-size:13px;margin:0 0 20px">Cycling Training Intelligence System v1.0</p>

    <h3 style="color:var(--blue-light);font-size:15px;margin:20px 0 8px">What It Is</h3>
    <p style="color:var(--text-secondary);font-size:14px;line-height:1.7">
      A fully automated training analytics dashboard built for serious endurance cycling. It consolidates data from multiple sources into a single view, runs performance modeling, and generates a coaching assessment grounded in real numbers. The dashboard regenerates daily from live data with no manual input.
    </p>

    <h3 style="color:var(--blue-light);font-size:15px;margin:20px 0 8px">Data Sources</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
      <div style="background:var(--surface-elevated);border-radius:8px;padding:12px">
        <div style="color:var(--text-primary);font-weight:600;font-size:13px;margin-bottom:4px">TrainingPeaks</div>
        <div style="color:var(--text-muted);font-size:12px;line-height:1.6">Planned and completed workouts, TSS, IF, NP, duration. Coach-prescribed training plans. Power zones. Synced daily.</div>
      </div>
      <div style="background:var(--surface-elevated);border-radius:8px;padding:12px">
        <div style="color:var(--text-primary);font-weight:600;font-size:13px;margin-bottom:4px">Whoop</div>
        <div style="color:var(--text-muted);font-size:12px;line-height:1.6">Recovery scores, HRV, resting heart rate, sleep duration and quality. Used for recovery-performance correlation analysis.</div>
      </div>
      <div style="background:var(--surface-elevated);border-radius:8px;padding:12px">
        <div style="color:var(--text-primary);font-weight:600;font-size:13px;margin-bottom:4px">Strava</div>
        <div style="color:var(--text-muted);font-size:12px;line-height:1.6">Activity power zone distributions (time-in-zone from actual ride data), club events, social rides. Real power file analysis.</div>
      </div>
      <div style="background:var(--surface-elevated);border-radius:8px;padding:12px">
        <div style="color:var(--text-primary);font-weight:600;font-size:13px;margin-bottom:4px">Open-Meteo</div>
        <div style="color:var(--text-muted);font-size:12px;line-height:1.6">Weather forecasts for ride planning and race-day conditions. Kit recommendations based on temperature and wind.</div>
      </div>
    </div>

    <h3 style="color:var(--blue-light);font-size:15px;margin:20px 0 8px">Architecture</h3>
    <p style="color:var(--text-secondary);font-size:14px;line-height:1.7">
      Built in Python. All data is stored in PostgreSQL with dedicated tables for workouts, recovery, training load (PMC), FTP history, power zones, and generated insights. A template engine fills 78+ dynamic placeholders to produce this static HTML dashboard with Chart.js visualizations. The system runs as a CLI tool (<code style="color:var(--blue-light);font-size:13px">cycling-training</code>) with subcommands for syncing, analysis, and generation.
    </p>

    <h3 style="color:var(--blue-light);font-size:15px;margin:20px 0 8px">Analytics Engine</h3>
    <ul style="color:var(--text-secondary);font-size:13px;line-height:2;padding-left:20px">
      <li><strong>PMC Modeling:</strong> Chronic Training Load (CTL), Acute Training Load (ATL), and Training Stress Balance (TSB) calculated daily with exponential weighted averages</li>
      <li><strong>FTP Projection:</strong> Based on actual normalized power trends from high-intensity workouts, not linear extrapolation</li>
      <li><strong>Recovery-Performance Correlation:</strong> Statistical analysis across 178+ overlapping Whoop/TP days measuring how recovery metrics affect workout execution</li>
      <li><strong>Workout Quality Scoring:</strong> Composite metric from TSS adherence and IF adherence vs. planned targets</li>
      <li><strong>Race Modeling:</strong> Pacing, taper timing, and race-day CTL/TSB projections based on historical patterns</li>
      <li><strong>Coaching Assessment:</strong> AI-generated narrative channeling periodization principles, refreshed daily with current data</li>
    </ul>

    <h3 style="color:var(--blue-light);font-size:15px;margin:20px 0 8px">Coaching Persona</h3>
    <p style="color:var(--text-secondary);font-size:14px;line-height:1.7">
      The coaching assessment is written by an AI system prompt modeled on the methodologies of Hunter Allen, Joe Friel, and Andrew Coggan, with a focus on data-driven decision making for endurance athletes. Real coaching is provided by Max Blinderman via TrainingPeaks. The AI assessment synthesizes training data into actionable narrative; it supplements but does not replace the human coach.
    </p>

    <div style="margin-top:24px;padding-top:16px;border-top:1px solid var(--border);color:var(--text-muted);font-size:12px;text-align:center">
      Built by Auri Wren &middot; Powered by PostgreSQL, Chart.js, and Python &middot; Source: github.com/auriwren/cycling-training (private)
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const weeklyTSS = [
  {week:'Feb 10',tss:118.8,flu:false},{week:'Feb 17',tss:77.7,flu:false},{week:'Feb 24',tss:282.9,flu:false},{week:'Mar 03',tss:168.4,flu:false},{week:'Mar 10',tss:451.8,flu:false},{week:'Mar 17',tss:412.3,flu:false},{week:'Mar 24',tss:393.1,flu:false},{week:'Mar 31',tss:283.2,flu:false},{week:'Apr 07',tss:589.4,flu:false},{week:'Apr 14',tss:536.7,flu:false},{week:'Apr 21',tss:143.5,flu:false},{week:'Apr 28',tss:580.2,flu:false},{week:'May 05',tss:274.1,flu:false},{week:'May 12',tss:784.0,flu:false},{week:'May 19',tss:161.0,flu:false},{week:'May 26',tss:596.0,flu:false},{week:'Jun 02',tss:578.3,flu:false},{week:'Jun 09',tss:820.5,flu:false},{week:'Jun 16',tss:0.0,flu:false},{week:'Jun 23',tss:593.1,flu:false},{week:'Jun 30',tss:243.9,flu:false},{week:'Jul 07',tss:514.7,flu:false},{week:'Jul 14',tss:685.3,flu:false},{week:'Jul 21',tss:695.4,flu:false},{week:'Jul 28',tss:562.1,flu:false},{week:'Aug 04',tss:444.2,flu:false},{week:'Aug 11',tss:343.4,flu:false},{week:'Aug 18',tss:698.2,flu:false},{week:'Aug 25',tss:122.8,flu:false},{week:'Sep 01',tss:30.0,flu:false},{week:'Sep 08',tss:582.2,flu:false},{week:'Sep 15',tss:450.3,flu:false},{week:'Sep 22',tss:457.2,flu:false},{week:'Sep 29',tss:423.1,flu:false},{week:'Oct 06',tss:0.0,flu:false},{week:'Oct 13',tss:112.1,flu:false},{week:'Oct 20',tss:255.5,flu:false},{week:'Oct 27',tss:268.1,flu:false},{week:'Nov 03',tss:232.6,flu:false},{week:'Nov 10',tss:69.6,flu:false},{week:'Nov 17',tss:75.8,flu:false},{week:'Nov 24',tss:306.7,flu:false},{week:'Dec 01',tss:198.9,flu:false},{week:'Dec 08',tss:377.4,flu:false},{week:'Dec 15',tss:341.7,flu:false},{week:'Dec 22',tss:277.6,flu:false},{week:'Dec 29',tss:347.1,flu:false},{week:'Jan 05',tss:60.7,flu:true},{week:'Jan 12',tss:353.1,flu:false},{week:'Jan 19',tss:464.9,flu:false},{week:'Jan 26',tss:372.0,flu:false},{week:'Feb 02',tss:448.5,flu:false},{week:'Feb 09',tss:138.0,flu:false}
];

const pmcData = [
  {d:'Nov 22',ctl:1.8,atl:10.8,tsb:-9.0},{d:'Nov 23',ctl:1.8,atl:9.3,tsb:-7.5},{d:'Nov 24',ctl:3.1,atl:16.0,tsb:-12.9},{d:'Nov 25',ctl:4.6,atl:23.4,tsb:-18.8},{d:'Nov 26',ctl:4.5,atl:20.0,tsb:-15.5},{d:'Nov 27',ctl:4.4,atl:17.2,tsb:-12.8},{d:'Nov 28',ctl:4.3,atl:14.7,tsb:-10.4},{d:'Nov 29',ctl:6.2,atl:24.9,tsb:-18.7},{d:'Nov 30',ctl:8.4,atl:35.2,tsb:-26.8},{d:'Dec 01',ctl:8.2,atl:30.1,tsb:-22.0},{d:'Dec 02',ctl:9.4,atl:34.3,tsb:-24.9},{d:'Dec 03',ctl:11.1,atl:40.7,tsb:-29.6},{d:'Dec 04',ctl:10.8,atl:34.9,tsb:-24.1},{d:'Dec 05',ctl:12.0,atl:38.6,tsb:-26.6},{d:'Dec 06',ctl:11.7,atl:33.0,tsb:-21.4},{d:'Dec 07',ctl:11.4,atl:28.3,tsb:-16.9},{d:'Dec 08',ctl:11.1,atl:24.3,tsb:-13.1},{d:'Dec 09',ctl:12.3,atl:29.2,tsb:-16.9},{d:'Dec 10',ctl:14.3,atl:39.2,tsb:-24.9},{d:'Dec 11',ctl:14.0,atl:33.6,tsb:-19.6},{d:'Dec 12',ctl:15.3,atl:38.8,tsb:-23.5},{d:'Dec 13',ctl:18.5,atl:54.6,tsb:-36.1},{d:'Dec 14',ctl:18.1,atl:46.8,tsb:-28.7},{d:'Dec 15',ctl:17.7,atl:40.1,tsb:-22.5},{d:'Dec 16',ctl:18.6,atl:42.3,tsb:-23.7},{d:'Dec 17',ctl:20.4,atl:50.2,tsb:-29.7},{d:'Dec 18',ctl:19.9,atl:43.0,tsb:-23.1},{d:'Dec 19',ctl:21.0,atl:46.2,tsb:-25.2},{d:'Dec 20',ctl:23.5,atl:57.2,tsb:-33.8},{d:'Dec 21',ctl:22.9,atl:49.1,tsb:-26.2},{d:'Dec 22',ctl:23.9,atl:51.5,tsb:-27.5},{d:'Dec 23',ctl:25.7,atl:58.4,tsb:-32.7},{d:'Dec 24',ctl:25.1,atl:50.1,tsb:-24.9},{d:'Dec 25',ctl:24.5,atl:42.9,tsb:-18.4},{d:'Dec 26',ctl:23.9,atl:36.8,tsb:-12.8},{d:'Dec 27',ctl:26.0,atl:47.5,tsb:-21.4},{d:'Dec 28',ctl:25.4,atl:40.7,tsb:-15.3},{d:'Dec 29',ctl:24.8,atl:34.9,tsb:-10.1},{d:'Dec 30',ctl:24.2,atl:29.9,tsb:-5.7},{d:'Dec 31',ctl:25.9,atl:39.4,tsb:-13.4},{d:'Jan 01',ctl:25.3,atl:33.8,tsb:-8.4},{d:'Jan 02',ctl:26.1,atl:37.5,tsb:-11.3},{d:'Jan 03',ctl:27.1,atl:41.7,tsb:-14.6},{d:'Jan 04',ctl:29.4,atl:53.5,tsb:-24.0},{d:'Jan 05',ctl:29.1,atl:47.9,tsb:-18.9},{d:'Jan 06',ctl:28.4,atl:41.1,tsb:-12.7},{d:'Jan 07',ctl:27.7,atl:35.2,tsb:-7.5},{d:'Jan 08',ctl:27.1,atl:30.2,tsb:-3.1},{d:'Jan 09',ctl:26.4,atl:25.9,tsb:0.5},{d:'Jan 10',ctl:25.8,atl:22.2,tsb:3.6},{d:'Jan 11',ctl:26.2,atl:25.6,tsb:0.7},{d:'Jan 12',ctl:26.9,atl:29.8,tsb:-2.8},{d:'Jan 13',ctl:26.3,atl:25.5,tsb:0.8},{d:'Jan 14',ctl:26.8,atl:28.6,tsb:-1.9},{d:'Jan 15',ctl:26.2,atl:24.6,tsb:1.6},{d:'Jan 16',ctl:26.8,atl:28.9,tsb:-2.0},{d:'Jan 17',ctl:27.9,atl:34.6,tsb:-6.8},{d:'Jan 18',ctl:30.2,atl:47.8,tsb:-17.6},{d:'Jan 19',ctl:29.5,atl:41.0,tsb:-11.5},{d:'Jan 20',ctl:30.5,atl:45.7,tsb:-15.1},{d:'Jan 21',ctl:32.0,atl:52.3,tsb:-20.3},{d:'Jan 22',ctl:31.2,atl:44.9,tsb:-13.6},{d:'Jan 23',ctl:32.0,atl:47.6,tsb:-15.6},{d:'Jan 24',ctl:34.2,atl:58.6,tsb:-24.4},{d:'Jan 25',ctl:36.0,atl:65.9,tsb:-29.9},{d:'Jan 26',ctl:35.2,atl:56.5,tsb:-21.3},{d:'Jan 27',ctl:36.0,atl:58.4,tsb:-22.4},{d:'Jan 28',ctl:37.6,atl:64.8,tsb:-27.2},{d:'Jan 29',ctl:36.7,atl:55.5,tsb:-18.8},{d:'Jan 30',ctl:37.6,atl:58.3,tsb:-20.6},{d:'Jan 31',ctl:39.7,atl:67.8,tsb:-28.1},{d:'Feb 01',ctl:38.7,atl:58.1,tsb:-19.3},{d:'Feb 02',ctl:39.5,atl:59.7,tsb:-20.2},{d:'Feb 03',ctl:39.6,atl:57.4,tsb:-17.8},{d:'Feb 04',ctl:41.1,atl:64.3,tsb:-23.1},{d:'Feb 05',ctl:40.2,atl:55.1,tsb:-14.9},{d:'Feb 06',ctl:40.5,atl:55.0,tsb:-14.5},{d:'Feb 07',ctl:42.4,atl:64.6,tsb:-22.2},{d:'Feb 08',ctl:42.7,atl:63.0,tsb:-20.3},{d:'Feb 09',ctl:41.7,atl:54.0,tsb:-12.3},{d:'Feb 10',ctl:41.6,atl:52.1,tsb:-10.4},{d:'Feb 11',ctl:43.0,atl:58.5,tsb:-15.6},{d:'Feb 12',ctl:46.0,atl:50.0,tsb:-4.0}
];

const recovery30 = [{d:'Jan 12',r:37},{d:'Jan 13',r:73},{d:'Jan 14',r:86},{d:'Jan 15',r:64},{d:'Jan 16',r:82},{d:'Jan 17',r:53},{d:'Jan 18',r:65},{d:'Jan 19',r:27},{d:'Jan 20',r:92},{d:'Jan 21',r:63},{d:'Jan 22',r:44},{d:'Jan 23',r:73},{d:'Jan 24',r:85},{d:'Jan 25',r:85},{d:'Jan 26',r:47},{d:'Jan 27',r:89},{d:'Jan 28',r:80},{d:'Jan 29',r:40},{d:'Jan 30',r:70},{d:'Jan 31',r:52},{d:'Feb 01',r:38},{d:'Feb 02',r:74},{d:'Feb 03',r:78},{d:'Feb 04',r:80},{d:'Feb 05',r:61},{d:'Feb 06',r:47},{d:'Feb 07',r:63},{d:'Feb 08',r:61},{d:'Feb 09',r:61},{d:'Feb 10',r:86},{d:'Feb 11',r:56},{d:'Feb 12',r:47}];

const hrv30 = [{d:'Jan 12',h:23},{d:'Jan 13',h:33},{d:'Jan 14',h:38},{d:'Jan 15',h:32},{d:'Jan 16',h:38},{d:'Jan 17',h:28},{d:'Jan 18',h:32},{d:'Jan 19',h:25},{d:'Jan 20',h:39},{d:'Jan 21',h:31},{d:'Jan 22',h:26},{d:'Jan 23',h:33},{d:'Jan 24',h:36},{d:'Jan 25',h:38},{d:'Jan 26',h:28},{d:'Jan 27',h:44},{d:'Jan 28',h:65},{d:'Jan 29',h:28},{d:'Jan 30',h:37},{d:'Jan 31',h:30},{d:'Feb 01',h:25},{d:'Feb 02',h:37},{d:'Feb 03',h:38},{d:'Feb 04',h:40},{d:'Feb 05',h:36},{d:'Feb 06',h:30},{d:'Feb 07',h:35},{d:'Feb 08',h:35},{d:'Feb 09',h:34},{d:'Feb 10',h:40},{d:'Feb 11',h:33},{d:'Feb 12',h:33}];

const sleep30 = [{d:'Jan 12',s:6.6},{d:'Jan 13',s:6.2},{d:'Jan 14',s:6.7},{d:'Jan 15',s:6.9},{d:'Jan 16',s:5.4},{d:'Jan 17',s:7.9},{d:'Jan 18',s:6.6},{d:'Jan 19',s:7.1},{d:'Jan 20',s:7.0},{d:'Jan 21',s:7.5},{d:'Jan 22',s:8.0},{d:'Jan 23',s:7.8},{d:'Jan 24',s:8.9},{d:'Jan 25',s:6.2},{d:'Jan 26',s:7.1},{d:'Jan 27',s:6.3},{d:'Jan 28',s:6.0},{d:'Jan 29',s:6.2},{d:'Jan 30',s:7.0},{d:'Jan 31',s:8.1},{d:'Feb 01',s:9.5},{d:'Feb 02',s:7.4},{d:'Feb 03',s:6.9},{d:'Feb 04',s:8.3},{d:'Feb 05',s:6.6},{d:'Feb 06',s:7.1},{d:'Feb 07',s:7.3},{d:'Feb 08',s:6.7},{d:'Feb 09',s:7.0},{d:'Feb 10',s:6.5},{d:'Feb 11',s:7.4},{d:'Feb 12',s:6.3}];

const qualityData = [{d:'Aug 06',q:99.4},{d:'Aug 08',q:82.3},{d:'Aug 09',q:54.7},{d:'Aug 12',q:96.2},{d:'Aug 15',q:95.7},{d:'Aug 17',q:86.7},{d:'Aug 18',q:96.6},{d:'Aug 19',q:91.7},{d:'Aug 20',q:99.5},{d:'Aug 23',q:81.9},{d:'Sep 01',q:91.7},{d:'Sep 09',q:85.8},{d:'Sep 10',q:86.1},{d:'Sep 13',q:86.3},{d:'Sep 15',q:91.7},{d:'Sep 16',q:88.0},{d:'Sep 17',q:89.9},{d:'Sep 20',q:94.7},{d:'Sep 23',q:91.0},{d:'Sep 24',q:89.6},{d:'Sep 27',q:99.7},{d:'Sep 29',q:88.3},{d:'Oct 01',q:97.6},{d:'Oct 03',q:87.1},{d:'Oct 22',q:91.5},{d:'Oct 24',q:86.9},{d:'Oct 25',q:69.0},{d:'Oct 26',q:91.7},{d:'Oct 29',q:78.4},{d:'Oct 31',q:87.4},{d:'Nov 01',q:94.4},{d:'Nov 03',q:92.0},{d:'Nov 04',q:91.3},{d:'Nov 06',q:87.0},{d:'Nov 07',q:85.8},{d:'Nov 24',q:93.2},{d:'Nov 25',q:95.3},{d:'Nov 29',q:79.0},{d:'Nov 30',q:92.2},{d:'Dec 02',q:93.6},{d:'Dec 03',q:91.8},{d:'Dec 05',q:90.8},{d:'Dec 09',q:94.1},{d:'Dec 10',q:88.9},{d:'Dec 12',q:91.9},{d:'Dec 13',q:93.2},{d:'Dec 16',q:90.5},{d:'Dec 17',q:86.9},{d:'Dec 19',q:89.9},{d:'Dec 20',q:92.3},{d:'Dec 22',q:86.5},{d:'Dec 23',q:88.6},{d:'Dec 27',q:86.1},{d:'Dec 31',q:86.4},{d:'Jan 02',q:94.1},{d:'Jan 03',q:87.9},{d:'Jan 04',q:92.2},{d:'Jan 11',q:94.6},{d:'Jan 12',q:92.2},{d:'Jan 14',q:94.1},{d:'Jan 16',q:91.7},{d:'Jan 17',q:94.1},{d:'Jan 18',q:93.1},{d:'Jan 20',q:95.4},{d:'Jan 21',q:92.2},{d:'Jan 23',q:91.5},{d:'Jan 24',q:92.8},{d:'Jan 25',q:87.8},{d:'Jan 27',q:93.4},{d:'Jan 28',q:90.3},{d:'Jan 30',q:92.5},{d:'Jan 31',q:90.6},{d:'Feb 02',q:94.1},{d:'Feb 03',q:78.3},{d:'Feb 04',q:88.5},{d:'Feb 06',q:91.3},{d:'Feb 07',q:91.7},{d:'Feb 08',q:79.2},{d:'Feb 10',q:74.2},{d:'Feb 11',q:89.2}];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHART CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Chart.defaults.color = '#9ca3b4';
Chart.defaults.borderColor = 'rgba(42,45,58,0.5)';
Chart.defaults.font.family = "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif";
Chart.defaults.font.size = 11;

// Collapsible section toggle
function toggleSection(header) {
  header.classList.toggle('open');
  const content = header.nextElementSibling;
  while(content && !content.classList.contains('collapsible-content')) { break; }
  // Find the collapsible-content sibling
  let el = header.nextElementSibling;
  while(el) {
    if(el.classList && el.classList.contains('collapsible-content')) {
      el.classList.toggle('open');
      break;
    }
    el = el.nextElementSibling;
  }
}

// TSS Chart - default to last 20 weeks
let showFullTSS = false;
let tssChart;
function getTSSSlice() {
  if(showFullTSS) return weeklyTSS;
  return weeklyTSS.slice(-20);
}
function renderTSSChart() {
  const slice = getTSSSlice();
  if(tssChart) tssChart.destroy();
  tssChart = new Chart(document.getElementById('tssChart'), {
    type: 'bar',
    data: {
      labels: slice.map(d=>d.week),
      datasets: [{
        data: slice.map(d=>d.tss),
        backgroundColor: slice.map(d=> {
          if(d.flu) return 'rgba(239,68,68,0.7)';
          if(d.tss>=500) return 'rgba(59,130,246,0.8)';
          if(d.tss>=300) return 'rgba(59,130,246,0.5)';
          return 'rgba(59,130,246,0.25)';
        }),
        borderRadius: 3,
        borderSkipped: false,
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        legend: {display:false},
        tooltip: {
          callbacks: {
            label: ctx => {
              const idx = showFullTSS ? ctx.dataIndex : ctx.dataIndex + (weeklyTSS.length - 20);
              let extra = weeklyTSS[idx] && weeklyTSS[idx].flu ? ' (FLU WEEK)' : '';
              return `TSS: ${ctx.raw}${extra}`;
            }
          }
        }
      },
      scales: {
        x: {ticks:{maxRotation:45,font:{size:9}},grid:{display:false}},
        y: {beginAtZero:true,title:{display:true,text:'Weekly TSS'}}
      }
    }
  });
}
function toggleTSSRange() {
  showFullTSS = !showFullTSS;
  document.getElementById('tssToggle').textContent = showFullTSS ? 'Show last 20 weeks' : 'Show full year';
  document.getElementById('tssRangeLabel').textContent = showFullTSS ? '(12 Months)' : '(Last 20 Weeks)';
  renderTSSChart();
}
renderTSSChart();

// PMC Chart
new Chart(document.getElementById('pmcChart'), {
  type: 'line',
  data: {
    labels: pmcData.map(d=>d.d),
    datasets: [
      {label:'CTL (Fitness)',data:pmcData.map(d=>d.ctl),borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,0.1)',fill:true,tension:0.3,pointRadius:2},
      {label:'ATL (Fatigue)',data:pmcData.map(d=>d.atl),borderColor:'#ef4444',backgroundColor:'rgba(239,68,68,0.05)',fill:false,tension:0.3,pointRadius:2},
      {label:'TSB (Form)',data:pmcData.map(d=>d.tsb),borderColor:'#22c55e',backgroundColor:'rgba(34,197,94,0.05)',fill:true,tension:0.3,pointRadius:2,borderDash:[4,4]}
    ]
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    plugins: {legend:{position:'top',labels:{boxWidth:12,padding:8}}},
    scales: {
      x: {ticks:{maxRotation:45,font:{size:9}},grid:{display:false}},
      y: {title:{display:true,text:'Load / Form'}}
    }
  }
});

// Recovery Chart
new Chart(document.getElementById('recoveryChart'), {
  type: 'bar',
  data: {
    labels: recovery30.map(d=>d.d),
    datasets: [{
      data: recovery30.map(d=>d.r),
      backgroundColor: recovery30.map(d=> d.r>=67?'rgba(34,197,94,0.6)':d.r>=34?'rgba(234,179,8,0.6)':'rgba(239,68,68,0.6)'),
      borderRadius: 2,
    }]
  },
  options: {
    responsive:true,maintainAspectRatio:false,
    plugins:{legend:{display:false}},
    scales:{x:{ticks:{maxRotation:45,font:{size:8},maxTicksLimit:10},grid:{display:false}},y:{beginAtZero:true,max:100}}
  }
});

// HRV Chart
const hrv7d = hrv30.map((d,i)=>{
  const slice = hrv30.slice(Math.max(0,i-6),i+1);
  return slice.reduce((a,b)=>a+b.h,0)/slice.length;
});
new Chart(document.getElementById('hrvChart'), {
  type:'line',
  data:{
    labels:hrv30.map(d=>d.d),
    datasets:[
      {label:'HRV',data:hrv30.map(d=>d.h),borderColor:'rgba(96,165,250,0.3)',pointRadius:2,pointBackgroundColor:'rgba(96,165,250,0.5)',fill:false,tension:0.1},
      {label:'7d Avg',data:hrv7d,borderColor:'#60a5fa',borderWidth:2,pointRadius:0,fill:false,tension:0.3}
    ]
  },
  options:{
    responsive:true,maintainAspectRatio:false,
    plugins:{legend:{display:false}},
    scales:{x:{ticks:{maxRotation:45,font:{size:8},maxTicksLimit:10},grid:{display:false}},y:{title:{display:true,text:'ms'}}}
  }
});

// Sleep Chart
new Chart(document.getElementById('sleepChart'), {
  type:'bar',
  data:{
    labels:sleep30.map(d=>d.d),
    datasets:[{
      data:sleep30.map(d=>d.s),
      backgroundColor:sleep30.map(d=>d.s>=7.5?'rgba(96,165,250,0.6)':d.s>=6?'rgba(96,165,250,0.35)':'rgba(239,68,68,0.4)'),
      borderRadius:2,
    }]
  },
  options:{
    responsive:true,maintainAspectRatio:false,
    plugins:{legend:{display:false},annotation:{}},
    scales:{x:{ticks:{maxRotation:45,font:{size:8},maxTicksLimit:10},grid:{display:false}},y:{min:4,max:10,title:{display:true,text:'Hours'}}}
  }
});

// Quality Chart
new Chart(document.getElementById('qualityChart'), {
  type:'line',
  data:{
    labels:qualityData.map(d=>d.d),
    datasets:[{
      data:qualityData.map(d=>d.q),
      borderColor:'#60a5fa',
      backgroundColor:'rgba(96,165,250,0.1)',
      fill:true,tension:0.3,pointRadius:2,pointBackgroundColor:'#60a5fa'
    }]
  },
  options:{
    responsive:true,maintainAspectRatio:false,
    plugins:{legend:{display:false}},
    scales:{x:{ticks:{maxRotation:45,font:{size:8},maxTicksLimit:12},grid:{display:false}},y:{min:60,max:100,title:{display:true,text:'Quality Score'}}}
  }
});

// Zone Distribution Donut
new Chart(document.getElementById('zoneDonut'), {
  type:'doughnut',
  data:{
    labels:['Endurance','Tempo','Threshold/VO2','Free Ride','Sweetspot','Other High Int.'],
    datasets:[{
      data:[9332, 2900, 5026, 607, 1517, 0],
      backgroundColor:['#60a5fa','#4ade80','#f87171','#94a3b8','#eab308','#d97706'],
      borderColor:'#1a1d27',borderWidth:2,
    }]
  },
  options:{
    responsive:true,maintainAspectRatio:true,
    cutout:'60%',
    plugins:{
      legend:{display:false},
      tooltip:{callbacks:{label:ctx=>{const total=ctx.dataset.data.reduce((a,b)=>a+b,0);const pct=total?((ctx.raw/total)*100).toFixed(1):0;return `${ctx.label}: ${(ctx.raw/60).toFixed(1)}h (${pct}%)`;}}}
    }
  }
});

// Mobile: reduce chart tick density
if(window.innerWidth <= 600) {
  Chart.defaults.scales.x = Chart.defaults.scales.x || {};
  Chart.defaults.plugins.legend.labels.font = {size: 9};
}
const isMobile = window.innerWidth <= 600;
const mobileMaxTicks = isMobile ? 6 : undefined;

// Monthly Max NP Trend Chart
new Chart(document.getElementById('npTrendChart'), {
  type:'bar',
  data:{
    labels:["Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "Jan", "Feb"],
    datasets:[{
      label:'Max NP',
      data:[217, 220, 235, 216, 243, 224, 229, 238, 228, 227, 212, 215, 214],
      backgroundColor:['rgba(96,165,250,0.35)','rgba(96,165,250,0.35)','rgba(96,165,250,0.5)','rgba(96,165,250,0.35)','rgba(249,115,22,0.7)','rgba(96,165,250,0.35)','rgba(96,165,250,0.35)','rgba(96,165,250,0.5)','rgba(96,165,250,0.35)','rgba(96,165,250,0.35)','rgba(96,165,250,0.35)','rgba(96,165,250,0.35)','rgba(96,165,250,0.35)'],
      borderRadius:3,
    }]
  },
  options:{
    responsive:true,maintainAspectRatio:false,
    plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>`Max NP: ${ctx.raw}W`}}},
    scales:{x:{grid:{display:false},ticks:{font:{size:9}}},y:{min:200,max:260,title:{display:true,text:'Watts'}}}
  }
});

// FTP Projection Chart (data-driven)
const ftpMonths = ['Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
// Base plateau Feb-Mar, build phase gains Apr-Jun, continued gains Jul-Dec
const ftpProjection = [263, 263, 265, 272, 277, 285, 287, 287, 291, 295, 299];
new Chart(document.getElementById('ftpChart'), {
  type:'line',
  data:{
    labels:ftpMonths,
    datasets:[
      {label:'Projected FTP',data:ftpProjection,borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,0.1)',fill:true,tension:0.3,pointRadius:3},
      {label:'300W Target',data:ftpMonths.map(()=>300),borderColor:'rgba(34,197,94,0.4)',borderDash:[6,4],pointRadius:0,fill:false},
      {label:'Base Phase',data:[263,263,265,null,null,null,null,null,null,null,null],borderColor:'rgba(234,179,8,0.6)',borderWidth:3,pointRadius:0,fill:false,tension:0.3},
      {label:'Build Phase',data:[null,null,265,272,278,null,null,null,null,null,null],borderColor:'rgba(249,115,22,0.8)',borderWidth:3,pointRadius:0,fill:false,tension:0.3}
    ]
  },
  options:{
    responsive:true,maintainAspectRatio:false,
    plugins:{legend:{position:'top',labels:{boxWidth:12,padding:8}}},
    scales:{x:{grid:{display:false}},y:{min:255,max:310,title:{display:true,text:'Watts'}}}
  }
});
</script>
</body>
</html>